<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shawn's AI-Powered Infographic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff; 
        }
        .notion-card {
            background-color: #ffffff;
            border-radius: 8px;
            border: 1px solid #ededed;
            transition: background-color 0.2s ease;
        }
        .notion-card:hover {
            background-color: #f7f7f5;
        }
        .notion-button {
            background-color: transparent;
            color: #37352f;
            transition: background-color 0.2s ease;
            border-radius: 6px;
        }
        .notion-button:hover {
            background-color: #e3e3e1;
        }
        .notion-button-primary {
             background-color: #f7f7f5;
             border: 1px solid #e3e3e1;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 50%;
            top: -20px;
            transform: translateX(-50%);
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: #555;
            border: 4px solid #f1f1f0;
            z-index: 10;
        }
        .timeline-line {
            background-color: #e3e3e1; 
        }
        @media (min-width: 1024px) {
            .timeline-item::before {
                left: -9px;
                top: 50%;
                transform: translateY(-50%);
            }
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
           .chart-container {
                height: 350px; 
           }
        }
        .modal-overlay, #chat-widget {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        .loader {
            border: 4px solid #e5e5e5;
            border-top: 4px solid #333;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-[#37352f]">

    <div class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="text-center mb-16">
            <h1 class="text-3xl md:text-4xl font-bold text-[#1d1d1f]">Shawn's AI-Powered Infographic</h1>
            <p class="mt-3 text-base md:text-lg text-[#7f7f7f]">Get to know my work through this interactive experience.</p>
            <div class="mt-8 text-center">
                <button id="header-chat-btn" class="notion-button notion-button-primary font-semibold py-2 px-5 flex items-center justify-center mx-auto">
                    <span class="mr-2 text-lg">✨</span> Ask AI About My Work
                </button>
            </div>
        </header>

        <main class="space-y-20">

            <section id="journey">
                <h2 class="text-2xl md:text-3xl font-bold text-center mb-12 text-[#1d1d1f]">My Journey into Design</h2>
                <div class="relative max-w-6xl mx-auto lg:flex justify-between items-stretch lg:space-x-6">
                    <div class="hidden lg:block absolute w-full h-0.5 timeline-line top-1/2 -translate-y-1/2"></div>
                    <div class="lg:hidden absolute w-0.5 h-full timeline-line left-1/2 -translate-x-1/2"></div>
                    
                    <div class="relative flex-1 mb-12 lg:mb-0 flex">
                         <div class="timeline-item"></div>
                        <div class="notion-card p-6 w-full">
                            <h3 class="text-lg font-bold mb-2 text-[#4A90E2]">1. The Spark</h3>
                            <p class="text-[#37352f] text-sm">Started in business, learning strategy and market needs. I became fascinated by the 'why' behind a product's success.</p>
                        </div>
                    </div>
                    <div class="relative flex-1 mb-12 lg:mb-0 flex">
                        <div class="timeline-item"></div>
                        <div class="notion-card p-6 w-full">
                            <h3 class="text-lg font-bold mb-2 text-[#4A90E2]">2. The Transition</h3>
                            <p class="text-[#37352f] text-sm">Pursued a Master of Digital Media to connect my business mindset with the craft of design, learning the 'how'.</p>
                        </div>
                    </div>
                    <div class="relative flex-1 mb-12 lg:mb-0 flex">
                         <div class="timeline-item"></div>
                        <div class="notion-card p-6 w-full">
                            <h3 class="text-lg font-bold mb-2 text-[#4A90E2]">3. The Foundation</h3>
                            <p class="text-[#37352f] text-sm">My first role at SAP was my design bootcamp, applying design principles to complex, real-world enterprise problems.</p>
                        </div>
                    </div>
                     <div class="relative flex-1 flex">
                         <div class="timeline-item"></div>
                        <div class="notion-card p-6 w-full">
                            <h3 class="text-lg font-bold mb-2 text-[#4A90E2]">4. Impact at Scale</h3>
                            <p class="text-[#37352f] text-sm">At Microsoft, I began leading design for major products, driving strategy and delivering measurable impact for millions of users.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="viva-engage" class="notion-card p-6 md:p-10 text-center">
                 <h2 class="text-2xl md:text-3xl font-bold mb-4 text-[#1d1d1f]">Current Focus: Viva Engage</h2>
                 <p class="text-base text-[#7f7f7f] mb-6 max-w-2xl mx-auto">I am currently leading design for leadership and storyline features, shaping how leaders connect with employees at scale across Microsoft Teams and Viva.</p>
                 <a href="mailto:shawnzpdeng@gmail.com" class="notion-button notion-button-primary font-semibold py-2 px-5 inline-flex items-center justify-center mx-auto">
                    Reach out for details
                </a>
            </section>

            <section id="amplify-saga" class="notion-card p-6 md:p-10">
                <h2 class="text-2xl md:text-3xl font-bold text-center mb-4 text-[#1d1d1f]">My Signature Story: The Viva Amplify Saga</h2>
                <p class="text-center text-base text-[#7f7f7f] mb-12 max-w-3xl mx-auto">How we built a successful app from scratch... and then "killed" it to make it a superpower.</p>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12">
                    
                    <div class="border-r-0 lg:border-r lg:border-dashed border-slate-200 pr-0 lg:pr-8">
                        <h3 class="text-xl font-bold text-[#1d1d1f] mb-4">Chapter 1: Idea to Impact</h3>
                        <p class="text-[#37352f] mb-6 text-sm">We solved a critical gap for corporate communicators by building Microsoft's first dedicated solution for managing internal campaigns, achieving rapid product-market fit.</p>
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div class="notion-card p-4">
                                <p class="text-2xl md:text-3xl font-extrabold text-[#1d1d1f]">$8.8M</p>
                                <p class="text-xs text-slate-500 mt-1">FY24 Revenue</p>
                            </div>
                            <div class="notion-card p-4">
                                <p class="text-2xl md:text-3xl font-extrabold text-[#1d1d1f]">620K</p>
                                <p class="text-xs text-slate-500 mt-1">Monthly Active Users</p>
                            </div>
                            <div class="notion-card p-4">
                                <p class="text-2xl md:text-3xl font-extrabold text-[#1d1d1f]">120+</p>
                                <p class="text-xs text-slate-500 mt-1">Enterprise Customers</p>
                            </div>
                             <div class="notion-card p-4">
                                <p class="text-2xl md:text-3xl font-extrabold text-[#1d1d1f]">2.29K</p>
                                <p class="text-xs text-slate-500 mt-1">Campaigns Created</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 lg:mt-0">
                        <h3 class="text-xl font-bold text-[#1d1d1f] mb-4">Chapter 2: Impact to Evolution</h3>
                        <p class="text-[#37352f] mb-6 text-sm">We learned our app was 'overkill' for many. So, we evolved it from a destination into an invisible, embedded capability to meet users where they work.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="notion-card p-4 flex flex-col items-center justify-center">
                                <div class="chart-container" style="height:150px; max-height:150px;">
                                    <canvas id="adoptionRateChart"></canvas>
                                </div>
                                <p class="text-xs text-slate-500 mt-2 font-semibold">Adoption Rate</p>
                            </div>
                            <div class="notion-card p-4 flex flex-col items-center justify-center">
                                <div class="chart-container" style="height:150px; max-height:150px;">
                                    <canvas id="growthChart"></canvas>
                                </div>
                                 <p class="text-xs text-slate-500 mt-2 font-semibold">MoM Growth</p>
                            </div>
                        </div>
                        <div class="mt-6 flex items-center justify-center space-x-4 text-center font-semibold text-slate-700">
                            <div class="bg-slate-100 p-3 rounded-md text-sm">Module</div>
                             <div class="text-2xl text-slate-400">&rarr;</div>
                            <div class="bg-slate-200 p-3 rounded-md text-sm">Verb</div>
                             <div class="text-2xl text-slate-400">&rarr;</div>
                            <div class="bg-slate-800 text-white p-3 rounded-md text-sm">Superpower</div>
                        </div>
                    </div>

                </div>
                 <div class="text-center mt-12">
                    <button id="analyzeAmplifyBtn" class="notion-button notion-button-primary font-semibold py-2 px-4 flex items-center justify-center mx-auto">
                        <span class="mr-2">✨</span> Analyze this Project with AI
                    </button>
                </div>
            </section>
            
            <section id="foundation">
                <h2 class="text-2xl md:text-3xl font-bold text-center mb-12 text-[#1d1d1f]">The Foundation: Lessons from SAP</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    <div class="notion-card p-6">
                        <div class="text-3xl mb-3">📱</div>
                        <h3 class="text-lg font-bold mb-2 text-[#1d1d1f]">Product Design</h3>
                        <p class="text-[#37352f] text-sm">Translated complex data into intuitive mobile experiences for the SAP Analytics Cloud app.</p>
                    </div>
                     <div class="notion-card p-6">
                        <div class="text-3xl mb-3">⚙️</div>
                        <h3 class="text-lg font-bold mb-2 text-[#1d1d1f]">Systems Design</h3>
                        <p class="text-[#37352f] text-sm">Created coherence by authoring guidelines for the HANA & Analytics Design System.</p>
                    </div>
                     <div class="notion-card p-6">
                        <div class="text-3xl mb-3">🤝</div>
                        <h3 class="text-lg font-bold mb-2 text-[#1d1d1f]">Service Design</h3>
                        <p class="text-[#37352f] text-sm">Improved the entire design process through workflow challenges that onboarded and pressure-tested products.</p>
                    </div>
                </div>
                <div class="text-center mt-12">
                    <button id="analyzeSapBtn" class="notion-button notion-button-primary font-semibold py-2 px-4 flex items-center justify-center mx-auto">
                         <span class="mr-2">✨</span> Analyze this Experience with AI
                    </button>
                </div>
            </section>

             <section id="conclusion" class="text-center">
                <h2 class="text-2xl md:text-3xl font-bold text-center mb-6 text-[#1d1d1f]">What I Bring to the Table</h2>
                <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="notion-card p-4"><p class="font-semibold text-slate-700 text-sm">🚀 Strategic Thinking</p></div>
                    <div class="notion-card p-4"><p class="font-semibold text-slate-700 text-sm">🌐 Systems-Oriented</p></div>
                    <div class="notion-card p-4"><p class="font-semibold text-slate-700 text-sm">🎯 Impact-Driven</p></div>
                </div>
            </section>

        </main>
        
        <footer class="text-center mt-16 py-6 border-t border-slate-200">
            <p class="text-slate-500 text-xs">Infographic created based on the portfolio of Shawn Deng.</p>
        </footer>

    </div>

    <!-- AI Modal -->
    <div id="aiModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 md:p-8 transform scale-95 border border-slate-200">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h3 id="modalTitle" class="text-xl font-bold text-[#1d1d1f]">AI Analysis</h3>
                <button id="closeModalBtn" class="text-slate-500 hover:text-slate-800 text-3xl">&times;</button>
            </div>
            <div id="modalBody">
                <div id="modalLoader" class="flex justify-center items-center h-48">
                    <div class="loader"></div>
                </div>
                <div id="modalResult" class="hidden"></div>
            </div>
        </div>
    </div>

    <!-- AI Chatbot Widget -->
    <div id="chat-fab" class="fixed bottom-6 right-6 z-40">
        <button class="bg-white w-16 h-16 rounded-full flex items-center justify-center text-3xl transform hover:scale-110 shadow-lg border border-slate-200">
            <span>✨</span>
        </button>
    </div>

    <div id="chat-widget" class="fixed bottom-24 right-6 w-full max-w-md h-[70vh] max-h-[600px] z-40 hidden opacity-0 transform translate-y-4">
        <div class="bg-white h-full rounded-2xl shadow-2xl flex flex-col border border-slate-200">
            <header class="bg-slate-50 text-[#1d1d1f] p-4 rounded-t-2xl flex justify-between items-center border-b border-slate-200">
                <h3 class="font-bold text-base">Ask AI About My Work</h3>
                <button id="closeChatBtn" class="text-2xl opacity-70 hover:opacity-100">&times;</button>
            </header>
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4 bg-white">
                <div class="p-3 rounded-lg bg-slate-100 text-[#37352f] max-w-xs text-sm">
                    Hi there! Ask me anything about Shawn's projects, skills, or experience.
                </div>
            </div>
            <footer class="p-4 border-t bg-white">
                <form id="chat-form" class="flex items-center space-x-2">
                    <input type="text" id="chat-input" placeholder="Type your question..." class="flex-1 p-2 border border-slate-300 rounded-full focus:ring-2 focus:ring-[#4A90E2] focus:outline-none text-sm">
                    <button type="submit" class="bg-[#1d1d1f] text-white w-10 h-10 rounded-full flex items-center justify-center font-bold text-xl hover:bg-[#333] transition-colors">&uarr;</button>
                </form>
            </footer>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const knowledgeBase = `
                Shawn Deng - Portfolio Summary:
                
                Overall Profile: A product designer with a business background and over 6 years of experience, currently at Microsoft in Vancouver. He specializes in bridging user needs with strategic business goals to deliver measurable impact, focusing on design coherence in complex environments.
                
                ---
                
                Current Work: Viva Engage (Microsoft)
                - Role: Leading design for leadership and storyline features.
                - Goal: Shaping how leaders connect with employees at scale across Microsoft Teams and Viva. This work is ongoing and details are limited.
                
                ---
                
                Project: Viva Amplify Saga (Microsoft)
                
                Chapter 1 (Idea to Impact): 
                - Problem: Corporate communicators had broken workflows and no centralized tool in Microsoft 365 for internal campaigns.
                - Solution: Designed and launched Viva Amplify, Microsoft's first dedicated internal communication product. This created a new product category.
                - Role: Core designer, responsible for the foundational campaign management system.
                - Key Metrics: Drove $8.8M in FY24 revenue, scaled to 620K monthly active users within 16 months, acquired 120+ enterprise customers (like Unilever, Pfizer), and facilitated 2.29K campaigns.
                - Design System Challenge: Had to create coherence across three competing design systems: Fluent, Viva, and SharePoint. Championed Fluent v9 migration.
                
                Chapter 2 (Impact to Evolution):
                - Insight: The successful standalone app was 'overkill' for everyday communicators who didn't want to switch tools.
                - Vision: Transform Amplify from a destination app into an invisible, embedded capability ("making it a verb"). The goal was to meet users where they already work.
                - Solution: Led the design to integrate Amplify's power directly into SharePoint News. This was a strategic transformation.
                - Role: Co-designer on a 15-person cross-org feature crew, design system champion, and implementation lead.
                - Results: Achieved a 78% adoption rate among eligible internal users, with a 20% month-over-month growth during rollout. Proved a new embedded premium model for Microsoft.
                
                ---
                
                Experience: Foundational Work at SAP
                
                - Overall: This was his 'design bootcamp' after his Master's degree, where he learned to apply design to complex enterprise problems.
                - Product Design: Focused on the SAP Analytics Cloud mobile experience. Translated complex data concepts into intuitive mobile interfaces for iOS, Android, and responsive web.
                - Systems Design: Contributed to the SAP HANA & Analytics Design System. Authored guidelines for core layouts (canvas, table, etc.) to create consistency across different H&A products, bridging them with the main SAP Fiori design language.
                - Service Design: Worked in an internal 'Design Services' team to enable other designers. Created end-to-end product challenges to test usability and identify user pain points. Audited features and helped define the 'Golden Path' for customers. This work was about understanding the entire design ecosystem.
                
                ---
                
                Core Skills & Philosophy:
                - Strategic Thinking: Connects design decisions to business outcomes.
                - Systems-Oriented: Thrives in complex ecosystems and creates coherence.
                - Impact-Driven: Focuses on delivering measurable results.
                - Journey: Transitioned from a business background, through a Master of Digital Media, to a designer at SAP and now Microsoft, where he makes impact at scale.
            `;

            const tooltipTitleCallback = (tooltipItems) => {
                const item = tooltipItems[0];
                let label = item.chart.data.labels[item.dataIndex];
                if (Array.isArray(label)) { return label.join(' '); }
                return label;
            };
            
            new Chart(document.getElementById('adoptionRateChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Adopted', 'Not Adopted'],
                    datasets: [{ label: 'Adoption Rate', data: [78, 22], backgroundColor: ['#4A90E2', '#e5e5e5'], borderColor: ['#ffffff', '#ffffff'], borderWidth: 4, cutout: '70%' }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { callbacks: { title: tooltipTitleCallback } }, title: { display: true, text: '78%', position: 'bottom', align: 'center', font: { size: 24, weight: 'bold', family: 'Inter' }, color: '#1d1d1f', padding: { top: -60 } } }
                }
            });

            new Chart(document.getElementById('growthChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 4', 'Week 8', 'Week 12'],
                    datasets: [{ label: 'Adoption Growth', data: [21, 45, 65, 78], fill: true, backgroundColor: 'rgba(74, 144, 226, 0.1)', borderColor: '#4A90E2', tension: 0.4, pointBackgroundColor: '#4A90E2', pointBorderColor: '#fff', pointHoverBackgroundColor: '#fff', pointHoverBorderColor: '#4A90E2' }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, max: 100, ticks: { display: false }, grid: { display: false }, border: { display: false } }, x: { ticks: { display: false }, grid: { display: false }, border: { display: false } } },
                    plugins: { legend: { display: false }, tooltip: { callbacks: { title: tooltipTitleCallback } } }
                }
            });

            const modal = document.getElementById('aiModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const modalTitle = document.getElementById('modalTitle');
            const modalLoader = document.getElementById('modalLoader');
            const modalResult = document.getElementById('modalResult');

            const openModal = () => {
                modal.classList.remove('hidden');
                setTimeout(() => modal.classList.remove('opacity-0'), 10);
                setTimeout(() => modal.querySelector('.modal-content').classList.remove('scale-95'), 10);
            };
            const closeModal = () => {
                modal.querySelector('.modal-content').classList.add('scale-95');
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            };

            closeModalBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

            async function callGemini(prompt, schema) {
                modalResult.innerHTML = '';
                modalResult.classList.add('hidden');
                modalLoader.classList.remove('hidden');
                openModal();

                const apiKey = "%NEXT_PUBLIC_VITE_GEMINI_API_KEY%"; // Remember to add your API key here
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: { responseMimeType: "application/json", responseSchema: schema }
                };

                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error(`API call failed: ${response.status}`);
                    const result = await response.json();
                    if (result.candidates && result.candidates[0].content.parts[0]) {
                        renderResult(JSON.parse(result.candidates[0].content.parts[0].text));
                    } else { throw new Error("Invalid API response."); }
                } catch (error) {
                    modalResult.innerHTML = `<div class="text-red-500 text-center">Sorry, an error occurred. Please try again.</div>`;
                    console.error("Gemini API Error:", error);
                } finally {
                    modalLoader.classList.add('hidden');
                    modalResult.classList.remove('hidden');
                }
            }

            function renderResult(data) {
                let html = '';
                for (const key in data) {
                    const title = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    html += `<h4 class="text-lg font-bold text-[#1d1d1f] mt-4 mb-2">${title}</h4><ul class="list-disc list-inside space-y-2 text-[#37352f] text-sm">`;
                    data[key].forEach(item => { html += `<li>${item}</li>`; });
                    html += '</ul>';
                }
                modalResult.innerHTML = html;
            }

            document.getElementById('analyzeAmplifyBtn').addEventListener('click', () => {
                modalTitle.textContent = 'AI Analysis: Viva Amplify Saga';
                const prompt = `Analyze this project: Viva Amplify. Chapter 1: built a new product for internal campaigns, hitting $8.8M revenue & 620K MAU. Chapter 2: pivoted from a standalone app to an embedded service, boosting adoption to 78%.`;
                const schema = { type: "OBJECT", properties: { key_design_decisions: { type: "ARRAY", items: { type: "STRING" } }, potential_challenges: { type: "ARRAY", items: { type: "STRING" } }, strategic_implications: { type: "ARRAY", items: { type: "STRING" } } } };
                callGemini(prompt, schema);
            });
            document.getElementById('analyzeSapBtn').addEventListener('click', () => {
                modalTitle.textContent = 'AI Analysis: SAP Foundation';
                const prompt = `Analyze this experience: Foundational design work at SAP covering Product Design (mobile analytics), Systems Design (guidelines), and Service Design (improving design processes).`;
                const schema = { type: "OBJECT", properties: { core_competencies_developed: { type: "ARRAY", items: { type: "STRING" } }, impact_on_career: { type: "ARRAY", items: { type: "STRING" } }, key_takeaways: { type: "ARRAY", items: { type: "STRING" } } } };
                callGemini(prompt, schema);
            });
            
            const chatFab = document.getElementById('chat-fab');
            const chatWidget = document.getElementById('chat-widget');
            const closeChatBtn = document.getElementById('closeChatBtn');
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            const chatMessages = document.getElementById('chat-messages');
            const headerChatBtn = document.getElementById('header-chat-btn');

            const toggleChat = (isOpen) => {
                if (isOpen) {
                    chatWidget.classList.remove('hidden');
                    setTimeout(() => {
                        chatWidget.classList.remove('opacity-0', 'translate-y-4');
                        chatFab.classList.add('opacity-0', 'scale-0');
                    }, 10);
                } else {
                    chatWidget.classList.add('opacity-0', 'translate-y-4');
                    chatFab.classList.remove('opacity-0', 'scale-0');
                    setTimeout(() => chatWidget.classList.add('hidden'), 300);
                }
            };

            chatFab.addEventListener('click', () => toggleChat(true));
            headerChatBtn.addEventListener('click', () => toggleChat(true));
            closeChatBtn.addEventListener('click', () => toggleChat(false));

            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const userInput = chatInput.value.trim();
                if (!userInput) return;

                appendMessage(userInput, 'user');
                chatInput.value = '';
                appendMessage('...', 'ai', true);

                const prompt = `You are a helpful assistant answering questions about the product designer Shawn Deng. Use only the following information to answer the user's question. Do not use any external knowledge. Keep your answers concise and directly related to the provided context.

                --- CONTEXT START ---
                ${knowledgeBase}
                --- CONTEXT END ---
                
                User's Question: "${userInput}"`;

                try {
                    const apiKey = "%NEXT_PUBLIC_VITE_GEMINI_API_KEY%"; // Remember to add your API key here
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    const payload = { contents: [{ parts: [{ text: prompt }] }] };

                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error('API Error');
                    const result = await response.json();
                    
                    const aiResponse = result.candidates[0].content.parts[0].text;
                    updateLastMessage(aiResponse);

                } catch (error) {
                    console.error("Chatbot Error:", error);
                    updateLastMessage("Sorry, I couldn't connect to the AI. Please try again later.");
                }
            });

            function appendMessage(text, sender, isLoader = false) {
                const messageDiv = document.createElement('div');
                messageDiv.textContent = text;
                
                if (sender === 'user') {
                    messageDiv.className = 'p-3 rounded-lg bg-[#4A90E2] text-white max-w-xs ml-auto text-sm';
                } else {
                    messageDiv.className = 'p-3 rounded-lg bg-slate-100 text-[#37352f] max-w-xs text-sm';
                }

                if (isLoader) {
                    messageDiv.id = 'ai-loader';
                    messageDiv.innerHTML = `<div class="flex items-center space-x-2"><div class="w-2 h-2 bg-slate-400 rounded-full animate-pulse"></div><div class="w-2 h-2 bg-slate-400 rounded-full animate-pulse delay-75"></div><div class="w-2 h-2 bg-slate-400 rounded-full animate-pulse delay-150"></div></div>`;
                }

                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function updateLastMessage(text) {
                const loader = document.getElementById('ai-loader');
                if (loader) {
                    loader.textContent = text;
                    loader.id = '';
                }
            }

        });
    </script>
</body>
</html>
